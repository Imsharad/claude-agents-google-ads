Product Requirement Document (PRD): The "Growth-Tier" Ads Protocol Agent
1. Executive Summary
The Growth-Tier Ads Protocol Agent is a vertical-agnostic, intelligent system designed to automate the deployment of Google Ads campaigns for any high-value offer (Service, Education, SaaS, or Consultation). It enforces a strict financial protocol (spend ₹20k to unlock ₹20k credit) to lower CAC by 50%, while leveraging Generative AI to adapt creative strategy to the specific market vertical.

2. Core Philosophy: The Protocol vs. The Product
This agent does not just "run ads"; it executes a Financial & Strategic Protocol.

Financial Protocol: Spend exactly ₹20,000 in 60 days to maximize platform incentives.
Strategic Protocol: Move from validation (Micro-Budget) to optimization (Growth-Budget) using A/B testing and algorithmic bidding.
The Variable: The "Product/Service" is now a configuration input, not a hardcoded value.
3. System Architecture
3.1 Configuration Interface (Input Layer)
The agent shall accept a "Campaign Configuration" object to adapt to different verticals.

{
  "vertical_type": "EDUCATION | SAAS | SERVICE | E-COMMERCE",
  "offer_name": "String (e.g., AI Workshop, CRM Tool, Dental Implant)",
  "target_audience_broad": "String (e.g., Mid-Career Professionals, Sales VP)",
  "value_proposition_primary": "String (e.g., Save time, Increase revenue)",
  "monetization_model": "TRIPWIRE_UPSELL | DIRECT_SALE | LEAD_GEN | BOOK_CALL"
}
3.2 Intelligence Layer (The "Brain")
3.2.1 Universal Persona Segmentation
Instead of hardcoding "Manager/Freelancer", the agent dynamically breaks the target_audience_broad into 3 distinct psychological cohorts suitable for the specific vertical.

Logic: Identify 3 distinct purchase drivers (e.g., Status, Fear, Efficiency).
Output: 3 Ad Group themes optimized for the specific vertical.
3.2.2 Abstracted Asset Generation (The "Polarity Test")
The agent applies the "Polarity Test" to any vertical, testing two psychological extremes.

Angle A (The Pull): Desire, Gain, Efficiency (e.g., "Master AI", "Close More Deals", "Smile Confidently").
Angle B (The Push): Fear, Loss Aversion, FOMO (e.g., "Don't get replaced", "Stop losing leads", "Prevent tooth loss").
3.2.3 Dynamic Upsell/Bridging
The "Backend" logic adapts to the monetization_model.

For Education: Generates Webinar Transition Script.
For SaaS: Generates Demo Booking Nudge ("Stop struggling manually, let us show you...").
For Service: Generates Consultation Value Stack ("This audit is worth $500, free for you today").
3.3 Execution Layer (The Campaign Manager)
3.3.1 Growth-Tier Financial Constraints
Global Rule: Daily Budget = Total Budget / 30. (Standard: ₹660/day).
Bidding Rule: "Maximize Clicks" with Cap.
Cap Logic: Cap = Max acceptable CPA / Estimated Conversion Rate (Dynamically calculated or defaulted to ₹50).
3.3.2 Keyword Expansion Protocol
Constraint: Use "Phrase Match" to capture intent variation.
Safety: Auto-deploy "Universal Negative List" (free, cheap, crack, job) + "Vertical Specific Negatives" (generated by LLM).

3.4 Claude Agent SDK Architecture
This section defines the technical implementation of the autonomous agent runtime.

3.4.1 SDK Initialization
The agent uses Claude Agent SDK to enable autonomous operation. Configuration:

```python
from claude_agent_sdk import ClaudeSDKClient, ClaudeAgentOptions

options = ClaudeAgentOptions(
    model="claude-3-5-sonnet-20241022",
    max_turns=30,
    system_prompt=load_system_prompt("prompts/google_ads_agent.txt"),
    custom_tools=register_google_ads_tools(),
    permission_mode="ask"  # User approval for campaign mutations
)

client = ClaudeSDKClient(options)
```

3.4.2 MCP Server Setup
The agent registers Google Ads API operations as Model Context Protocol (MCP) tools:

- **Lifecycle**: MCP server initialized on agent startup
- **Tool Discovery**: Automatic registration via @tool decorator
- **Error Handling**: Google Ads API exceptions wrapped and surfaced to agent for reasoning

3.4.3 Tool Registration Pattern
Each Google Ads operation (create campaign, fetch metrics, etc.) is registered as a callable tool:

```python
@tool
def create_growth_tier_campaign(
    customer_id: str,
    campaign_name: str,
    budget_micros: int,
    tier: str
) -> str:
    """Creates a Google Ads campaign with tier-based bidding."""
    # Implementation details
```

3.4.4 System Prompt Structure
The agent's system prompt defines:

- **Role**: "You are a Google Ads campaign automation specialist..."
- **Capabilities**: Campaign creation, persona generation, optimization
- **Boundaries**: Cannot modify live campaigns without user approval
- **Example Interactions**: Sample user requests and expected responses
4. Operational Workflows
4.1 "The Setup" (Day 0)
User provides Campaign Configuration.
Agent hallucinates 3 Sub-Personas & 2 Ad Angles.
Agent drafting the Campaign Structure (Keywords, Negatives, Ads).
User Review: User approves/edits the strategy.
4.2 "The Ramp" (Days 1-14)
Objective: Buy data.
Action: Force 50/50 rotation of Angle A vs Angle B.
Metric Check: Is CTR > 1%? If no, kill Angle, request new creative from Intelligence Layer.
4.3 "The Optimization" (Days 15+)
Objective: Cut fat.
Action 1: Identify "Losing Persona" (High CPC, Low Conv). -> Pause Ad Group.
Action 2: Identify "Winning Persona". -> Increase Bid Cap by 20%.
5. Deployment Scenarios (Examples)
Scenario A: The Workshop (Original Research)
Input: Education, "AI Workshop", Tripwire Model.
Output: Sub-Personas (Manager, Marketer, Freelancer), "Benefit vs Fear" Ads, Webinar Upsell Script.
Scenario B: The Local Service (e.g., Dentist)
Input: Service, "Invisalign", Lead Gen Model.
Output: Sub-Personas (The Bridals, The Professionals, The Parents), "Confidence vs Health Risk" Ads, "Free Consultation" Bridge.
Scenario C: Micro-SaaS
Input: SaaS, "Email Automation Tool", Free Trial Model.
Output: Sub-Personas (The Solo Founder, The Agency Owner, The Enterprise rep), "Save Time vs Stop Burning Cash" Ads, "14-Day Free Trial" Bridge.
6. Functional Requirements Summary

## Core Requirements

### REQ-1: Dynamic Configuration Payload
Accept dynamic Configuration payload with strict validation:
- Schema validation via Pydantic models
- Enum constraints for vertical_type and monetization_model
- Required field enforcement
- String length limits for user-facing text

### REQ-2: Variable-Injected LLM Prompts
LLM Prompt Templates must be variable-injected (not hardcoded text):
- Storage format: YAML files in prompts/ directory
- Variable placeholders: {vertical_type}, {offer_name}, {target_audience_broad}, {value_proposition_primary}
- Template switching: Logic to select appropriate prompt based on monetization_model
- Versioning: Track prompt versions for A/B testing

### REQ-3: Tier-Based Bidding Strategy
Bidding logic maps to Growth-Tier Protocol monetization models:
- **TRIPWIRE_UPSELL**: Maximize Conversions with Target CPA
- **DIRECT_SALE**: Target ROAS (Return on Ad Spend)
- **LEAD_GEN**: Maximize Clicks with CPC cap
- **BOOK_CALL**: Maximize Conversions (no target)

### REQ-4: Hierarchical Reporting Structure
Reporting must group data by "Persona" and "Angle" regardless of vertical:
- Level 1 Queries: Campaign/AdGroup metrics (no keyword segment)
- Level 2 Queries: Keyword-specific (SEARCH campaigns only)
- Avoid implicit filtering by respecting Google Ads API constraints
- Handle privacy thresholds (null data for small audiences)

## API & Infrastructure Requirements

### REQ-5: Google Ads API Version & Authentication
- **API Version**: v22 or higher (proto_plus mode required)
- **Configuration File**: google-ads.yaml with structure:
  ```yaml
  developer_token: YOUR_DEV_TOKEN
  client_id: YOUR_CLIENT_ID
  client_secret: YOUR_CLIENT_SECRET
  refresh_token: YOUR_REFRESH_TOKEN
  login_customer_id: YOUR_MCC_ID (optional)
  use_proto_plus: True
  ```
- **Authentication Flow**: Installed Application flow (OAuth2) for initial setup
- **Token Storage**: Securely store refresh_token, auto-refresh access_token

### REQ-6: Policy Compliance Exception Handler
Implement Try-Catch-Exempt-Retry algorithm for policy violations:

1. **Catch**: Wrap all mutation operations (create campaign, upload ad, etc.) in try-catch
2. **Detect**: Check for `GoogleAdsException.error_code == policy_finding_error`
3. **Extract**: Parse `policy_topic_entries` from exception
4. **Exempt**: Construct `PolicyValidationParameter` with `ignorable_policy_topics`
5. **Retry**: Re-submit mutation with exemption parameter
6. **Escalate**: If retry fails, log detailed error and alert human operator

**Example Flow**:
```python
try:
    create_ad(customer_id, ad_copy)
except GoogleAdsException as ex:
    if ex.failure.errors[0].error_code.policy_finding_error:
        policy_topics = extract_policy_topics(ex)
        retry_with_exemption(customer_id, ad_copy, policy_topics)
    else:
        escalate_to_human(ex)
```

## Intelligence Layer Requirements

### REQ-7: LLM Persona Generation Schema
Output schema for persona objects:
```json
{
  "personas": [
    {
      "name": "The Status Seeker",
      "pain_point": "Feels overlooked for promotions",
      "purchase_driver": "Career advancement",
      "ad_group_name": "persona_status_seeker"
    }
  ]
}
```

### REQ-8: Ad Copy Format Validation
- Headlines: 30 characters maximum (hard constraint)
- Descriptions: 90 characters maximum (hard constraint)
- Policy pre-check: Avoid prohibited claims (e.g., "guaranteed", "free money")
- Language: Match customer account language setting

### REQ-9: Negative Keyword Management
- Universal Negative List: free, cheap, crack, torrent, download, job, career, hiring, apply
- Vertical-Specific Negatives: LLM-generated (minimum 10 per vertical)
- Funnel Sculpting: Tier 1 keywords added as negatives in Tier 2/3 campaigns
- Implementation: Use `SharedSetService` for universal list, `CampaignCriterionService` for campaign-level

## Monitoring & Optimization Requirements

### REQ-10: Golden Ratio Budget Scaler
Replace static budget formula with Fibonacci-based scaling:

**Decision Matrix** (based on LTV:CAC ratio):

| LTV:CAC Ratio | Action | Formula |
|---------------|--------|---------|
| < 1.0 | Pause Campaign | N/A |
| 1.0 - 2.9 | Maintain | Current Budget |
| 3.0 - 3.9 | Scale Moderately | Next = Current × 1.618 |
| 4.0+ | Scale Aggressively | Next = Current × 2.618 |

**Circuit Breaker**: Max daily budget = ₹2,000 (prevent runaway spend)
**Exception**: Tripwire model campaigns exempt from pause rule (prioritize email capture)

### REQ-11: CTR Threshold Monitoring
- **Frequency**: Daily (not real-time due to API delay)
- **Threshold**: CTR < 1% with impressions > 100
- **Action**: Pause ad via `AdService.mutate(status=PAUSED)`
- **Trigger**: Request new creative variant from LLM (TASK-023)

### REQ-12: Conversion-Based Optimization
Define "Losing Persona":
- `cost_per_conversion > target_cpa` OR
- `conversions = 0 AND spend > ₹2,000`

**Action**: Pause ad group via `AdGroupService.mutate`

Define "Winning Persona":
- `cost_per_conversion < target_cpa` AND
- `conversions >= 5`

**Action** (depends on bidding strategy per REQ-3):
- Manual CPC: Increase keyword bids by 20%
- Maximize Clicks: Increase bid cap by 20%
- Target CPA/ROAS: No action (Smart Bidding auto-optimizes)

### REQ-13: Spend Pacing Monitor
Track progress toward ₹20k threshold:
- Query account-level spend daily
- Calculate required daily spend to hit ₹20k in 60-day window
- Alert user at milestones: ₹5k, ₹10k, ₹15k, ₹20k
- If underpacing: Recommend geo expansion or bid cap increase

## User Interaction Requirements

### REQ-14: Approval Workflow
Campaign setup must include user review gates:
- Agent generates: Keywords, Negatives, Ad Copy, Budget Plan
- User receives structured output (JSON or formatted text)
- User actions: `approve` | `edit` | `reject`
- On `reject`: Agent loops back to generation with user feedback
- Implementation: Claude SDK `permission_mode='ask'` for create_campaign tool

### REQ-15: Conversion Tracking Prerequisites
Before optimization (Phase 3), validate conversion tracking:
- Query existing conversion actions via `ConversionActionService`
- If none found: Provide setup instructions (website tag implementation)
- If found: Validate tracking is active (`impressions > 0` in last 7 days)
- Return `conversion_action` resource_name for reporting queries